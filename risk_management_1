"""
Ïƒ = ğ”¼(R2) - [ğ”¼(R)]2

R ve ğ”¼ sembolleri sÄ±rasÄ±yla yÄ±llÄ±k getiri ve beklentiyi ifade eder.


PortfÃ¶y varyansÄ±nÄ±n arkasÄ±ndaki fikir, portfÃ¶yde bulunan mevcut varlÄ±k kombinasyonunun genel olarak pozitif bir getiri saÄŸlayÄ±p saÄŸlamadÄ±ÄŸÄ±nÄ±n tespiti. 

PortfÃ¶y varyansÄ± hesaplanÄ±rken, kovaryans devreye giriyor ve formÃ¼l ÅŸu ÅŸekilde oluÅŸur:


Ïƒp2 = wa2Ïƒa2 + wb2Ïƒb2 + 2wawbCov(ra ,rb)

w aÄŸÄ±rlÄ±ÄŸÄ±, Ïƒ2 varyans ve Cov kovaryans matrisidir.

YukarÄ±da elde edilen varyansÄ±n karekÃ¶kÃ¼nÃ¼ almak bize portfÃ¶y standart sapmasÄ±nÄ± verir:

Ïƒp = Ïƒp2

DiÄŸer bir deyiÅŸle, portfÃ¶yÃ¼n beklenen getirisi, bireysel getirilerin aÄŸÄ±rlÄ±klÄ± ortalamasÄ±dÄ±r ve ÅŸu ÅŸekilde gÃ¶sterilebilir:

ğ”¼(R)=âˆ‘inwiRi = w1R1 + w2R2 â‹¯ + wnRn


Risk-getiri iliÅŸkisini gÃ¶rselleÅŸtirmek ve Python ile gerekli istatistikleri hesaplamak iÃ§in varsayÄ±msal bir portfÃ¶y oluÅŸturm Ã¶rneÄŸi:
"""


import statsmodels.api as sm
import numpy as np
import plotly.graph_objs as go
import matplotlib.pyplot as plt
import plotly
import warnings
warnings.filterwarnings('ignore')

n_assets = 5
n_simulation = 500

returns = np.random.randn(n_assets, n_simulation)

rand = np.random.rand(n_assets)
weights = rand/sum(rand)


def port_return(returns):
    rets = np.mean(returns, axis=1)
    cov = np.cov(rets.T, aweights=weights, ddof=1)
    portfolio_returns = np.dot(weights, rets.T)
    portfolio_std_dev = np.sqrt(np.dot(weights, np.dot(cov, weights)))
    return portfolio_returns, portfolio_std_dev

portfolio_returns, portfolio_std_dev = port_return(returns)

print(portfolio_returns)
print(portfolio_std_dev)

portfolio = np.array([port_return(np.random.randn(n_assets, i))  for i in range(1, 101)])


best_fit = sm.OLS(portfolio[:, 1], sm.add_constant(portfolio[:, 0]))\
           .fit().fittedvalues

fig = go.Figure()
fig.add_trace(go.Scatter(name='Risk-Return Relationship', x=portfolio[:,0], y=portfolio[:,1], mode='markers'))
fig.add_trace(go.Scatter(name='Best Fit Line', x=portfolio[:,0], y=best_fit, mode='lines'))
fig.update_layout(xaxis_title = 'Return', yaxis_title = 'Standard Deviation', width=900, height=470)

fig.show()

"""
YukarÄ±da verilen Python kodu aracÄ±lÄ±ÄŸÄ±yla oluÅŸturulan, risk ve getirinin birlikte gittiÄŸini doÄŸrular, 
ancak bu korelasyonun bÃ¼yÃ¼klÃ¼ÄŸÃ¼ bireysel hisse senedine ve finansal piyasa koÅŸullarÄ±na baÄŸlÄ± olarak deÄŸiÅŸir.


Risk yÃ¶netimi, riski ne pahasÄ±na olursa olsun azaltmakla ilgili deÄŸildir. Riski azaltmak, getiriden fedakarlÄ±k etmeyi gerektirebilir ve 
ÅŸirketler riski azaltmak kadar daha yÃ¼ksek getiri arayÄ±ÅŸÄ±nda olduÄŸu iÃ§in belirli bir seviyeye kadar tolere edilebilir. 

Bu nedenle, riski dÃ¼ÅŸÃ¼rÃ¼rken karÄ± maksimize etmek hassas ve iyi tanÄ±mlanmÄ±ÅŸ bir gÃ¶rev olmalÄ±dÄ±r.


Riski yÃ¶netmek, bir maliyeti olduÄŸu iÃ§in hassas bir iÅŸtir ve bununla baÅŸa Ã§Ä±kmak belirli ÅŸirket politikalarÄ± gerektirse de, 
olasÄ± risk stratejileri iÃ§in genel bir Ã§erÃ§eve mevcuttur. Bunlar:

    Yoksay: Bu stratejide ÅŸirketler tÃ¼m riskleri ve sonuÃ§larÄ±nÄ± kabul eder ve hiÃ§bir ÅŸey yapmamayÄ± tercih eder.

    Transfer: Bu strateji, riskten korunma veya baÅŸka yollarla risklerin Ã¼Ã§Ã¼ncÃ¼ bir tarafa aktarÄ±lmasÄ±nÄ± iÃ§erir.

    Azaltma: Åirketler, kÄ±smen, zararlÄ± etkilerinin taÅŸÄ±yamayacaÄŸÄ± ve/veya kendisine baÄŸlÄ± faydayÄ± bastÄ±ramayacaÄŸÄ± dÃ¼ÅŸÃ¼nÃ¼ldÃ¼ÄŸÃ¼nden, riski azaltmak iÃ§in bir strateji geliÅŸtirir.
    
    Riski kabul et: Åirketler, riski kabul etme stratejisini benimserlerse, riskleri uygun ÅŸekilde belirler ve bunlarÄ±n faydasÄ±nÄ± kabul ederler. DiÄŸer bir deyiÅŸle, bazÄ± faaliyetlerden kaynaklanan belirli risklerin hissedarlara deÄŸer kattÄ±ÄŸÄ± varsayÄ±ldÄ±ÄŸÄ±nda, bu strateji seÃ§ilebilir.


Finansal ÅŸirketler iÅŸ hayatlarÄ± boyunca Ã§eÅŸitli risklerle karÅŸÄ± karÅŸÄ±ya kalmaktadÄ±r. 
Bu riskler daha kolay tespit edilip deÄŸerlendirilebilecek ÅŸekilde farklÄ± kategorilere ayrÄ±labilir. 
Bu ana finansal risk tÃ¼rleri piyasa riski, kredi riski, operasyonel risk ve likidite riskidir ancak yine de bu kapsamlÄ± bir liste deÄŸildir.


PÄ°YASA RÄ°SKÄ°
Bu risk, finansal piyasadaki faktÃ¶rlerin deÄŸiÅŸmesinden kaynaklanmaktadÄ±r. Daha aÃ§Ä±k olmak gerekirse, Ã¶rneÄŸin, faiz oranÄ±ndaki bir artÄ±ÅŸ, 
kÄ±sa pozisyonu olan bir ÅŸirketi kÃ¶tÃ¼ etkileyebilir.

BaÅŸka bir piyasa riski kaynaÄŸÄ± hakkÄ±nda ikinci bir Ã¶rnek verilebilir; DÃ¶viz kuru. 

EmtialarÄ± ABD dolarÄ± cinsinden fiyatlandÄ±rÄ±lan uluslararasÄ± ticaret iÃ§eren bir ÅŸirket, ABD dolarÄ±ndaki bir deÄŸiÅŸime yÃ¼ksek oranda maruz kalmaktadÄ±r.
Tahmin edebileceÄŸiniz gibi, emtia fiyatlarÄ±ndaki herhangi bir deÄŸiÅŸiklik, bir ÅŸirketin finansal sÃ¼rdÃ¼rÃ¼lebilirliÄŸi iÃ§in bir tehdit oluÅŸturabilir. 
Emtia fiyatÄ±nÄ± doÄŸrudan etkileyen piyasa oyuncularÄ±, nakliye maliyeti vb. birÃ§ok temel unsur bulunmaktadÄ±r.


KREDÄ° RÄ°SKÄ°
Kredi riski en yaygÄ±n risklerden biridir. KarÅŸÄ± taraf borcunu Ã¶deyemediÄŸinde kredi riski ortaya Ã§Ä±kar. 
Ã–rneÄŸin, borÃ§lunun Ã¶demesini yapamamasÄ± durumunda kredi riski oluÅŸur. Kredi kalitesinin bozulmasÄ± aynÄ± zamanda bir kuruluÅŸun sahip olabileceÄŸi 
menkul kÄ±ymetlerin piyasa deÄŸerinin dÃ¼ÅŸmesi yoluyla bir risk kaynaÄŸÄ±dÄ±r(Horcher, 2011).


LÄ°KÄ°DTE RÄ°SK
Bir ÅŸirketin varlÄ±klarÄ±nÄ± kÄ±sa sÃ¼rede nakde Ã§evirememesi likidite riski kategorisine girer ve ÅŸirketin finansal yÃ¶netimine ve itibarÄ±na oldukÃ§a zarar verir.

OPERASYONEL RÄ°SK
AdÄ±ndan da anlaÅŸÄ±lacaÄŸÄ± gibi, operasyonel risk, bir ÅŸirket veya sektÃ¶rdeki doÄŸal operasyon(lar)Ä±n o ÅŸirketin gÃ¼nlÃ¼k operasyonlarÄ±, 
karlÄ±lÄ±ÄŸÄ± veya sÃ¼rdÃ¼rÃ¼lebilirliÄŸi iÃ§in bir tehdit oluÅŸturduÄŸunda ortaya Ã§Ä±kar. 
Operasyonel risk, hileli faaliyetleri, dÃ¼zenlemelere veya dahili prosedÃ¼rlere uyulmamasÄ±, eÄŸitim eksikliÄŸinden kaynaklanan kayÄ±plar vb.

Bir ÅŸirket hazÄ±rlÄ±ksÄ±z olarak bu risklerden bir veya birkaÃ§Ä±na maruz kalÄ±rsa ne olur? SÄ±k olmasa da cevabÄ±nÄ± tarihi olaylardan biliyoruz, 
ÅŸirket temerrÃ¼de dÃ¼ÅŸebilir ve bÃ¼yÃ¼k bir finansal darboÄŸaz yaÅŸayabilir.


Stulz'un â€œRisk yÃ¶netimi baÅŸarÄ±sÄ±zlÄ±klarÄ±: Nedir ve ne zaman olur?â€ baÅŸlÄ±klÄ± makalesi. (2008), temerrÃ¼de neden olan ana risk yÃ¶netimi baÅŸarÄ±sÄ±zlÄ±klarÄ±nÄ± Ã¶zetlemektedir:

1) Bilinen risklerin yanlÄ±ÅŸ Ã¶lÃ§Ã¼mÃ¼
2) Riskleri hesaba katmamak
3) Risklerin Ã¼st yÃ¶netime iletilmemesi
4) Risklerin izlenmesinde baÅŸarÄ±sÄ±zlÄ±k
5) Riskleri yÃ¶netmede baÅŸarÄ±sÄ±zlÄ±k
6) Uygun risk Ã¶lÃ§Ã¼tlerinin kullanÄ±lmamasÄ±


Finansman maliyeti ve firma deÄŸerlemesi bilgi asimetrisinden derinden etkilendiÄŸinden, bilgi asimetrisi ve finansal risk yÃ¶netimi el ele gider. 
Yani, bir firmanÄ±n varlÄ±klarÄ±nÄ±n deÄŸerlemesindeki belirsizlik, bir firmanÄ±n sÃ¼rdÃ¼rÃ¼lebilirliÄŸi iÃ§in bir tehdit oluÅŸturan borÃ§lanma maliyetini yÃ¼kseltebilir(Bkz. DeMarzo ve Darrell (1995) ve Froot, Scharfstein ve Stein (1993)).

YukarÄ±da anlatÄ±lan baÅŸarÄ±sÄ±zlÄ±klarÄ±n kÃ¶kleri Ã¶yle derinlerdedir ki, rasyonel karar vericinin iÃ§inde yaÅŸadÄ±ÄŸÄ± mÃ¼kemmel varsayÄ±msal dÃ¼nya bunlarÄ± aÃ§Ä±klayamaz. 
Bu noktada insan iÃ§gÃ¼dÃ¼leri ve kusurlu dÃ¼nya devreye girer ve disiplinlerin bir karÄ±ÅŸÄ±mÄ± daha makul gerekÃ§eler sunar. 
DolayÄ±sÄ±yla, Ters SeÃ§im ve Ahlaki Tehlikenin piyasa baÅŸarÄ±sÄ±zlÄ±klarÄ±nÄ± aÃ§Ä±klayan iki Ã¶nemli kategori olduÄŸu anlaÅŸÄ±lmÄ±ÅŸtÄ±r.

Bir tarafÄ±n bilgi avantajÄ±ndan yararlanmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ± bir tÃ¼r asimetrik bilgidir. Ters seÃ§im, satÄ±cÄ± alÄ±cÄ±lardan daha bilgili olduÄŸunda ortaya Ã§Ä±kar. 
Bu fenomen, Akerlof (1970) tarafÄ±ndan â€œLimon PiyasalarÄ±â€ olarak mÃ¼kemmel bir ÅŸekilde oluÅŸturulmuÅŸtur. Bu Ã§erÃ§evede limon, dÃ¼ÅŸÃ¼k kaliteyi ifade eder.



Python kullanarak ters seÃ§imi(Sigorta sektÃ¶rÃ¼nde) modellemeye Ã§alÄ±ÅŸalÄ±m. 

TÃ¼ketici fayda fonksiyonunun ÅŸÃ¶yle olduÄŸunu varsayalÄ±m:

U (x) = eÎ³x   (Fayda fonksiyonu, tÃ¼ketici tercihlerini(mal ve hizmet) temsil etmek iÃ§in kullanÄ±lan bir araÃ§tÄ±r ve riskten kaÃ§Ä±nan bireyler iÃ§in iÃ§bÃ¼keydir.)

Burada x gelir ve Î³, 0 ile 1 arasÄ±nda deÄŸerler alan bir parametredir.

Bu Ã¶rneÄŸin nihai amacÄ±, tÃ¼ketici faydasÄ±na dayalÄ± bir sigorta satÄ±n alÄ±p almamaya karar vermektir.
Gelirin 2 TL ve kazanÄ±n maliyetinin 1,5 TL olduÄŸunu varsayÄ±lmaktadÄ±r.

Sonra, dÄ±ÅŸsal olarak verilen ve dÃ¼zgÃ¼n daÄŸÄ±lmÄ±ÅŸ olan kayÄ±p olasÄ±lÄ±ÄŸÄ± Ï€'yi hesaplanacak.
Son bir adÄ±m olarak, dengeyi bulmak iÃ§in sigorta kapsamÄ± iÃ§in arz ve talebi tanÄ±mlanmasÄ± gerekiyor. 
AÅŸaÄŸÄ±daki kod bloÄŸu, ters seÃ§imi nasÄ±l modelleyebileceÄŸimizi gÃ¶sterir.
"""


import matplotlib.pyplot as plt
import numpy as np

plt.style.use('seaborn')

def utility(x):
  return(np.exp(x ** gamma))   #Riskten kaÃ§Ä±nan iÃ§in fayda iÅŸlevi  yazma.

pi = np.random.uniform(0,1,20)
pi = np.sort(pi)              #DÃ¼zgÃ¼n daÄŸÄ±lÄ±mdan rastgele Ã¶rnekler oluÅŸturma.


y = 2
c = 1.5
Q = 5
D = 0.01
gamma = 0.4

def supply(Q):
  return(np.mean(pi[-Q:]) * c)    #Sigorta sÃ¶zleÅŸmelerinin arz fonksiyonunun yazÄ±lmasÄ±.

def demand(D):
  return(np.sum(utility(y - D) > pi * utility(y - c) + (1 - pi) * utility(y)))  #Sigorta sÃ¶zleÅŸmelerinin talep fonksiyonunun yazÄ±lmasÄ±.

plt.figure()
plt.plot([demand(i) for i in np.arange(0, 1.9, 0.02)], np.arange(0, 1.9, 0.02),
         'r', label='sigorta talebi')
plt.plot(range(1,21), [supply(j) for j in range(1,21)],
         'g', label='sigorta arzÄ±')
plt.ylabel('Ortalama Maliyet')
plt.xlabel('MÃ¼ÅŸteri SayÄ±sÄ±')
plt.legend()
plt.show()

print('En bÃ¼yÃ¼k Ã¼Ã§ kayÄ±p : {}'.format(pi[-3:]))  #Son Ã¼Ã§ Ã¶ÄŸeyi seÃ§mek.


"""
ÅaÅŸÄ±rtÄ±cÄ± bir ÅŸekilde, her iki eÄŸri de aÅŸaÄŸÄ± doÄŸru eÄŸimlidir, bu da daha fazla insan sÃ¶zleÅŸme talep ettikÃ§e ve sÃ¶zleÅŸmeye daha fazla kiÅŸi eklendikÃ§e, 
sigorta sÃ¶zleÅŸmesinin fiyatÄ±nÄ± etkileyen riskin dÃ¼ÅŸtÃ¼ÄŸÃ¼nÃ¼ gÃ¶sterir.

DoÄŸru, sigorta arzÄ±nÄ± ve sÃ¶zleÅŸmenin ortalama maliyetini gÃ¶sterir ve kademeli olarak aÅŸaÄŸÄ± doÄŸru eÄŸimi gÃ¶steren doÄŸru, 
sigorta sÃ¶zleÅŸmelerine olan talebi gÃ¶sterir. 

Ortalama maliyete paralel olarak risklilik seviyesi azalmaktadÄ±r.




Piyasa baÅŸarÄ±sÄ±zlÄ±klarÄ± da asimetrik bilgiden kaynaklanmaktadÄ±r. Ahlaki tehlike durumunda, sÃ¶zleÅŸmenin bir tarafÄ± diÄŸer tarafa gÃ¶re daha fazla risk Ã¼stlenir. 
Resmi olarak, ahlaki tehlike, daha bilgili bir tarafÄ±n, emrindeki Ã¶zel bilgilerden baÅŸkalarÄ±nÄ±n zararÄ±na yararlandÄ±ÄŸÄ± bir durum olarak tanÄ±mlanabilir.

Ahlaki tehlikenin daha iyi anlaÅŸÄ±lmasÄ± iÃ§in, kredi piyasasÄ±ndan basit bir Ã¶rnek verilebilir: 

VarsayalÄ±m ki A iÅŸletmesi, finanse edilmesi mÃ¼mkÃ¼n olduÄŸu dÃ¼ÅŸÃ¼nÃ¼len projeyi finanse etmek iÃ§in kredi talep ediyor. 
A iÅŸletmesinin krediyi borÃ§ veren bankaya Ã¶nceden bildirimde bulunmaksÄ±zÄ±n C bankasÄ±na kredi borcunu Ã¶demek iÃ§in kullanmasÄ± durumunda ahlaki tehlike ortaya Ã§Ä±kar. 
BankalarÄ±n kredi tahsisi yaparken karÅŸÄ±laÅŸabilecekleri ahlaki tehlike durumu, asimetrik bilgi sonucunda ortaya Ã§Ä±kmakta, 
bankalarÄ±n kredi verme iÅŸtahlarÄ±nÄ± azaltmakta ve bankalarÄ±n kredi tahsis sÃ¼recine bu kadar emek harcamasÄ±nÄ±n sebeplerinden biri olarak karÅŸÄ±mÄ±za Ã§Ä±kmaktadÄ±r.



"""

